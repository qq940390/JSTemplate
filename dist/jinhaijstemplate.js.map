{"version":3,"sources":["../src/jinhaijstemplate.js"],"names":["JinhaiJSTemplate","template","datas","hasLoop","mainTemplate","dataName","keyName","indexName","_tpl","_data","console","log","templateDom","document","getElementById","innerHTML","parseTemplate","dataOut","i","length","push","parseLine","replace","join","_dataItem","matchs","reg","RegExp","match","m","module","exports"],"mappings":"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","sourcesContent":["class JinhaiJSTemplate {\n\n    constructor() {\n        this.template = '';\n        this.datas = {};\n        this.hasLoop = false;\n        this.mainTemplate = '';\n        this.dataName = '';\n        this.keyName = '';\n        this.indexName = '';\n    }\n\n    render(_tpl, _data) {\n        if (typeof _data != 'object') {\n            console.log('invalid data');\n            return '';\n        }\n        let templateDom = document.getElementById(_tpl);\n        if (templateDom) {\n            this.template = templateDom.innerHTML;\n        } else {\n            this.template = _tpl;\n        }\n        this.datas = _data;\n        this.parseTemplate();\n        let dataOut = [];\n        if (this.hasLoop === true && this.datas[this.dataName]) {\n            //多个\n            for (let i = 0; i < this.datas[this.dataName].length; i++) {\n                dataOut.push(this.parseLine(this.mainTemplate, this.datas[this.dataName][i]));\n            }\n        } else if (this.datas) {\n            //单个\n            dataOut.push(this.parseLine(this.mainTemplate, this.datas));\n        }\n        if (this.hasLoop) {\n            this.template = this.template.replace(/\\{\\{each\\s(\\w+)(\\sas)?\\s(\\w+)(\\s\\w+)\\}\\}([\\s\\S]+)\\{\\{\\/each\\}\\}/i, dataOut.join(''));\n        } else {\n            this.template = dataOut.join('');\n        }\n        this.template = this.parseLine(this.template, this.datas);\n        return this.template;\n    }\n\n    parseLine(_tpl, _dataItem) {\n        let matchs = false;\n        let reg = new RegExp(/\\{\\{((\\w+)\\.)?(\\w+)\\}\\}/ig);\n        if (matchs = _tpl.match(reg)) {\n            for (let i = 0; i < matchs.length; i++) {\n                let m = false;\n                if (m = matchs[i].match(/(\\w+)\\.(\\w+)/i)) {\n                    if (m[1] == this.keyName) _tpl = _tpl.replace('{{' + m[0] + '}}', _dataItem[m[2]]);\n                } else if (m = matchs[i].match(/(\\w+)/i)) {\n                    if (this.datas[m[0]]) {\n                        _tpl = _tpl.replace('{{' + m[0] + '}}', this.datas[m[0]]);\n                    } else {\n                        _tpl = _tpl.replace('{{' + m[0] + '}}', _dataItem[m[0]]);\n                    }\n                }\n            }\n        }\n        return _tpl;\n    }\n\n    parseTemplate() {\n        if (!this.template) return false;\n        let matchs = false;\n        if (matchs = this.template.match(/\\{\\{each\\s(\\w+)(\\sas)?\\s(\\w+)(\\s\\w+)\\}\\}([\\s\\S]+)\\{\\{\\/each\\}\\}/i)) {\n            this.hasLoop = true;\n            this.mainTemplate = matchs[5];\n            this.dataName = matchs[1];\n            this.keyName = matchs[3];\n            this.indexName = matchs[4];\n        } else {\n            this.hasLoop = false;\n            this.mainTemplate = this.template;\n        }\n    }\n\n}\n\nmodule.exports = JinhaiJSTemplate;\n"],"file":"jinhaijstemplate.js"}